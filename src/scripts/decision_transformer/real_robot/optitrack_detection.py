#!/usr/bin/env python

import time
import rospy
import numpy as np

from collections import namedtuple
from geometry_msgs.msg import PoseStamped

Position = namedtuple('Position', 'x, y, z')


class OptiTrack:
    def __init__(self):
        self.UPDATE_RATE = 10  # Hz
        self.rate = rospy.Rate(self.UPDATE_RATE)

        self.sub_motoman = rospy.Subscriber("/mocap/rigid_bodies/Motoman/pose",
                                            PoseStamped,
                                            self.motoman_callback)

        self.sub_object = rospy.Subscriber("/mocap/rigid_bodies/Object/pose",
                                           PoseStamped,
                                           self.object_callback)

        self.sub_target = rospy.Subscriber("/mocap/rigid_bodies/Target/pose",
                                           PoseStamped,
                                           self.target_callback)

        # Init positions
        self.motoman_position = None
        self.object_position = None
        self.target_position = None

        # Object trajectory
        self.object_trajectory = []
        self.object_trajectory_record = True
        self.landing_spot = None

        # Physical parameters
        self.object_dimension = 0.015

    def motoman_callback(self, msg):
        """
        Robotic arm's pose callback function
        """

        self.motoman_position = Position(msg.pose.position.x,
                                         msg.pose.position.y,
                                         msg.pose.position.z)

    def object_callback(self, msg):
        """
        Object's pose callback function
        """

        self.object_position = Position(msg.pose.position.x,
                                        msg.pose.position.y,
                                        msg.pose.position.z)

        dist, height = self.calculate_object_position_relative()
        if self.object_trajectory_record:
            self.object_trajectory.append((dist, height))

        if height < 0.04 and self.landing_spot is None:
            self.landing_spot = dist

    def target_callback(self, msg):
        """
        Target's pose callback function
        """

        self.target_position = Position(msg.pose.position.x,
                                        msg.pose.position.y,
                                        msg.pose.position.z)

    def calculate_target_position_relative(self):
        """
        Calculates target's position relative to the robotic arm.
        Returns (Distance [m], Angle [deg])
        """
        if self.target_position is None or self.motoman_position is None:
            time.sleep(1. / self.UPDATE_RATE)

        distance = (self.motoman_position.x - self.target_position.x) ** 2 + \
                   (self.motoman_position.y - self.target_position.y) ** 2
        distance = np.sqrt(distance)

        angle = np.arctan2((self.target_position.y - self.motoman_position.y),
                           (self.target_position.x - self.motoman_position.x))
        angle = np.rad2deg(angle)

        return distance, angle

    def calculate_object_position_relative(self):
        """
        Calculates object's position relative to the robotic arm.
        Returns (Distance [m], height [m])
        """
        if self.object_position is None or self.motoman_position is None:
            time.sleep(1. / self.UPDATE_RATE)

        distance = (self.motoman_position.x - self.object_position.x) ** 2 + \
                   (self.motoman_position.y - self.object_position.y) ** 2
        distance = np.sqrt(distance)

        height = self.object_position.z

        return distance, height

    def reset_object_trajectory(self):
        """
        Resets object's trajectory buffer
        """
        self.object_trajectory = []


if __name__ == '__main__':
    t = [(0.2809970326408415, 0.19683323800563812), (0.2810066300460341, 0.19683191180229187), (0.28096935464315237, 0.19681203365325928), (0.28095132709886783, 0.1968165636062622), (0.2809123086793561, 0.19685035943984985), (0.2809081528860288, 0.19685447216033936), (0.28094408566245493, 0.19685596227645874), (0.28092703186309126, 0.19680894911289215), (0.280957337051772, 0.19681750237941742), (0.28094544337270894, 0.1968056708574295), (0.2809218911136724, 0.19681240618228912), (0.2809430791708803, 0.19684450328350067), (0.28127942571022596, 0.1970546990633011), (0.28093708267196615, 0.19684486091136932), (0.2809690261335584, 0.1968546211719513), (0.2809383262598334, 0.19685712456703186), (0.2809531726028657, 0.1968553215265274), (0.28093740694442093, 0.1968381106853485), (0.28091653686151463, 0.19683203101158142), (0.28093328901428766, 0.1968231201171875), (0.28093467998125815, 0.19684822857379913), (0.2809611449548912, 0.19688065350055695), (0.2809383749357181, 0.19685962796211243), (0.2809381513267367, 0.19687089323997498), (0.28096800316286885, 0.19684769213199615), (0.28145616367347015, 0.19705073535442352), (0.2810568056608163, 0.19683462381362915), (0.28136670338703745, 0.19704771041870117), (0.281147114347245, 0.1968277543783188), (0.281130087926456, 0.19683633744716644), (0.28112938268823373, 0.1968659609556198), (0.2811051043436976, 0.19684679806232452), (0.2810307270597685, 0.19686658680438995), (0.28110335280180815, 0.19685043394565582), (0.2811291435065098, 0.19687607884407043), (0.2811418947421856, 0.19686557352542877), (0.28096096999674414, 0.1968405544757843), (0.28114509606169297, 0.19682703912258148), (0.2811173222363129, 0.196824848651886), (0.28113711684196135, 0.19683121144771576), (0.2810449787447936, 0.1968335062265396), (0.28112272565217516, 0.1968492567539215), (0.2811053900510551, 0.1968582570552826), (0.28112233318576885, 0.19690360128879547), (0.28110030187613255, 0.1968880593776703), (0.281124173398563, 0.19686990976333618), (0.28115533255941, 0.19685706496238708), (0.28104600781885664, 0.19685307145118713), (0.28103083113682864, 0.1968299150466919), (0.281121032039904, 0.19682103395462036), (0.2814615869038619, 0.19704970717430115), (0.2810160541007897, 0.19683606922626495), (0.28109524518445017, 0.19684091210365295), (0.2810844898748406, 0.19688084721565247), (0.2810983452704115, 0.19687959551811218), (0.2811161387687106, 0.19687138497829437), (0.28116300127559635, 0.19688290357589722), (0.2810932742271849, 0.19685138761997223), (0.2810388363167033, 0.1968490183353424), (0.2811158167438035, 0.19683720171451569), (0.2811200312559942, 0.19682370126247406), (0.2809368870932261, 0.19683822989463806), (0.2811288501332791, 0.1968282014131546), (0.2810581077406679, 0.19682453572750092), (0.28105410487617466, 0.19682882726192474), (0.28111181369379656, 0.1968526542186737), (0.28111451100570306, 0.19689837098121643), (0.28107643388673015, 0.1968809813261032), (0.2811052809854631, 0.19686894118785858), (0.28099238573831037, 0.19684943556785583), (0.28094234947360763, 0.19684217870235443), (0.28094002223612496, 0.19682711362838745), (0.2811548934281106, 0.1968080848455429), (0.28152431012204565, 0.19703654944896698), (0.28114570210313977, 0.19683809578418732), (0.2811214325793821, 0.19687071442604065), (0.28107205034973487, 0.19687536358833313), (0.28108542673036424, 0.1968708634376526), (0.28099245611342555, 0.1968826949596405), (0.2811176988581866, 0.19689130783081055), (0.28113249576551785, 0.1968311220407486), (0.28108727565870917, 0.19683004915714264), (0.28116157701716044, 0.19680048525333405), (0.28094087888833685, 0.19682151079177856), (0.28116958379598805, 0.19685417413711548), (0.28113942278833126, 0.1968894898891449), (0.2815023893308876, 0.19707904756069183), (0.2811091851923629, 0.1969105303287506), (0.2810057479706722, 0.1969125121831894), (0.2809894912349232, 0.196884423494339), (0.2811307226836636, 0.196876659989357), (0.2815208514553774, 0.19704006612300873), (0.2811813046798077, 0.19683723151683807), (0.2811447193381832, 0.1968357264995575), (0.2811390058900108, 0.19682808220386505), (0.2811136407481872, 0.19685149192810059), (0.28109166832141647, 0.1968679577112198), (0.2810945304771365, 0.19687357544898987), (0.2810076735693384, 0.19687682390213013), (0.28111198603231197, 0.19686971604824066), (0.28088615575630255, 0.19687089323997498), (0.2811391262404713, 0.1968265175819397), (0.28112943525579354, 0.19683830440044403), (0.28115244318779, 0.19683414697647095), (0.281048537577685, 0.19683939218521118), (0.28113089486647724, 0.196816548705101), (0.28107311778384514, 0.19683310389518738), (0.2811177677516221, 0.19683994352817535), (0.28101948920029785, 0.19686123728752136), (0.28110379719675915, 0.19685469567775726), (0.28112813040638246, 0.19684436917304993), (0.28102174122925727, 0.19686691462993622), (0.28110543624361073, 0.1968500167131424), (0.2807801810045421, 0.1968458592891693), (0.28101323393395256, 0.19684477150440216), (0.28153214102184687, 0.19704486429691315), (0.28107564365040794, 0.19683463871479034), (0.2809315769328803, 0.19684961438179016), (0.2811306271109798, 0.1968211829662323), (0.280922131164289, 0.1968228965997696), (0.2810365549810408, 0.1968415081501007), (0.2810201571406912, 0.19681468605995178), (0.2814939295433254, 0.1970745474100113), (0.28100131054032457, 0.1968643218278885), (0.2810906183732019, 0.1968555599451065), (0.28113693731354683, 0.1968766748905182), (0.28114107629281704, 0.1968992054462433), (0.2811065749211736, 0.1968664526939392), (0.28101331606750407, 0.19685523211956024), (0.28091412254834613, 0.1968402862548828), (0.2811636222962135, 0.19683924317359924), (0.28114048155907334, 0.19683343172073364), (0.28111777556061274, 0.19685447216033936), (0.2810824573325706, 0.19684110581874847), (0.28109241910059046, 0.19688016176223755), (0.28103049208695086, 0.19687657058238983), (0.2811082697040657, 0.19687782227993011), (0.28113986413899944, 0.1968623399734497), (0.28122246214823676, 0.1968190222978592), (0.2812746298811111, 0.19681189954280853), (0.28155910460291084, 0.1968008130788803), (0.28195315891340605, 0.19675321877002716), (0.28230128347042754, 0.19683881103992462), (0.28254615468792654, 0.19686071574687958), (0.28327235574101267, 0.19687393307685852), (0.2841317666832575, 0.19698163866996765), (0.2852964579768299, 0.1967501938343048), (0.286676749753661, 0.19689151644706726), (0.2874682300256147, 0.19645975530147552), (0.2893026585838153, 0.1963467001914978), (0.29171532725071675, 0.19712324440479279), (0.29358173204474425, 0.19695402681827545), (0.2961400001055183, 0.1973220407962799), (0.2984930281762121, 0.1973302811384201), (0.3012050259508716, 0.19744397699832916), (0.3044139297336267, 0.19762401282787323), (0.3078008030877521, 0.19795234501361847), (0.3114778914722443, 0.19832701981067657), (0.3154423657269071, 0.1987711787223816), (0.31962254799359324, 0.19931529462337494), (0.3240857318906675, 0.19996248185634613), (0.3287359773311612, 0.2005413919687271), (0.33372160623321057, 0.2012852132320404), (0.3387891778331732, 0.20227599143981934), (0.3441734099586463, 0.20338301360607147), (0.34982033944200736, 0.20472323894500732), (0.3557366340708712, 0.20598086714744568), (0.36192902447072095, 0.20767842233181), (0.36829067320242737, 0.2095862478017807), (0.37493634799785874, 0.2114139348268509), (0.3818975709168984, 0.21379819512367249), (0.38887071038140797, 0.2163475751876831), (0.3960928873158939, 0.21939221024513245), (0.40356257390046796, 0.22231866419315338), (0.4118357604748385, 0.22585856914520264), (0.4194916378492682, 0.22946929931640625), (0.427811708942637, 0.23375920951366425), (0.4362710493463007, 0.23809953033924103), (0.44489104632351045, 0.24295318126678467), (0.45373617297653646, 0.24814441800117493), (0.46266750316317684, 0.253607839345932), (0.47151010203207416, 0.2596111297607422), (0.48083700291477943, 0.2659493088722229), (0.489041583638587, 0.2728304862976074), (0.4983387048589198, 0.2799150347709656), (0.507353194261195, 0.2871023416519165), (0.5180299851949817, 0.2943536341190338), (0.5243954622341129, 0.30325907468795776), (0.5330331300054133, 0.31154149770736694), (0.5411670968823987, 0.31989073753356934), (0.5493034463313564, 0.3281348943710327), (0.5574651545835926, 0.3361870050430298), (0.5655212526068745, 0.3439914584159851), (0.5737219227658893, 0.35177749395370483), (0.5817956226268898, 0.35924437642097473), (0.5902217706875184, 0.36653274297714233), (0.5985371384691215, 0.3736193776130676), (0.6069651172046651, 0.38092491030693054), (0.6146678977540818, 0.38767358660697937), (0.6223288195670713, 0.3943597972393036), (0.6319115303088257, 0.4008205235004425), (0.6395481842433725, 0.4071252644062042), (0.64758351606062, 0.4132775664329529), (0.6565357083610659, 0.4197295010089874), (0.6643294139911682, 0.42525020241737366), (0.6722406458865816, 0.43095192313194275), (0.6805747514581425, 0.4363357424736023), (0.6886639939978406, 0.44161391258239746), (0.6967436928848698, 0.4470740854740143), (0.7049089095750332, 0.45180070400238037), (0.7130285192051438, 0.45654627680778503), (0.721107689590503, 0.46126967668533325), (0.7284958013335456, 0.4653432071208954), (0.7366433448033621, 0.46970415115356445), (0.7451887398477851, 0.4737967252731323), (0.75323091393762, 0.4778236746788025), (0.7610358421518695, 0.48156654834747314), (0.7693049524771084, 0.48540177941322327), (0.7780707012264706, 0.4898085296154022), (0.7857896042536598, 0.49203920364379883), (0.7937998368364813, 0.49489420652389526), (0.8021468844933074, 0.4980810284614563), (0.8103487304053403, 0.5008348822593689), (0.8182239406308787, 0.5034172534942627), (0.8265472701792707, 0.5058141946792603), (0.8344733518545624, 0.5081090927124023), (0.8425435312632321, 0.5101815462112427), (0.8505007573600892, 0.5121279954910278), (0.8584563789750062, 0.5138620138168335), (0.8665532574761848, 0.5154536366462708), (0.8732042147453308, 0.5183168649673462), (0.8823472755974263, 0.5184859037399292), (0.8902254878020783, 0.5192288756370544), (0.8986267559150654, 0.5203812122344971), (0.9064727533782803, 0.5210564732551575), (0.9144266850455264, 0.5215232968330383), (0.9224948179114068, 0.5218271613121033), (0.9307292119730276, 0.5220311284065247), (0.9389280768868047, 0.5218343138694763), (0.9468255224744707, 0.5217301249504089), (0.95488565155938, 0.5214281678199768), (0.9630103950187823, 0.5209607481956482), (0.9710567807783308, 0.5203152298927307), (0.9791627270545117, 0.5195862054824829), (0.9874953668048608, 0.5185524821281433), (0.9953736016034671, 0.517440140247345), (1.0037532955005024, 0.5160844922065735), (1.0118291844157676, 0.5145975351333618), (1.0200223340884773, 0.5128795504570007), (1.0283831879094671, 0.5110484957695007), (1.0365138207868798, 0.5089808106422424), (1.0444465280637616, 0.5067907571792603), (1.052460277456867, 0.5044712424278259), (1.0606493379195026, 0.501984715461731), (1.068355038826456, 0.4993327260017395), (1.0763095897499404, 0.4964948892593384), (1.084393625040306, 0.49348509311676025), (1.0922366161385608, 0.49029603600502014), (1.1001450707162985, 0.4869720935821533), (1.1080150483144484, 0.48339781165122986), (1.1159440978393476, 0.47970324754714966), (1.123868514228104, 0.47585147619247437), (1.1318218674970775, 0.47174617648124695), (1.1398428045702786, 0.4676302373409271), (1.1477895883447318, 0.46327030658721924), (1.1559496924036767, 0.4587692618370056), (1.1639059830704757, 0.45408421754837036), (1.1719694484870706, 0.44912368059158325), (1.1799855496765685, 0.44412297010421753), (1.1879938432885093, 0.43896567821502686), (1.1961477121820425, 0.4335135817527771), (1.2044885838535095, 0.42786505818367004), (1.212381583999527, 0.4220733046531677), (1.220529707962346, 0.4162951409816742), (1.2284232621702191, 0.4101267457008362), (1.236397001519591, 0.40398094058036804), (1.2447171808817281, 0.3976473808288574), (1.2526093813431824, 0.3910427987575531), (1.2604675172798685, 0.38435208797454834), (1.2684395422713142, 0.37740904092788696), (1.2761447127682668, 0.37034735083580017), (1.2840414078416575, 0.36307820677757263), (1.2923023002942744, 0.3556823432445526), (1.2998651848464804, 0.34805527329444885), (1.3077304806063523, 0.3403569757938385), (1.3154949825805275, 0.33244895935058594), (1.323297915531227, 0.3243612051010132), (1.3310703509905146, 0.3160639703273773), (1.3388675746498282, 0.3076825737953186), (1.3467663729870483, 0.298946350812912), (1.3544536451667069, 0.29028046131134033), (1.3621901701257237, 0.2814370393753052), (1.3700708093178549, 0.27232539653778076), (1.378314397331248, 0.2627805471420288), (1.3860332493596956, 0.25361379981040955), (1.3939531966772485, 0.2439129650592804), (1.4018847246598385, 0.2339908480644226), (1.4097426173708718, 0.2241290658712387), (1.4176912323088626, 0.21405227482318878), (1.4256387812699738, 0.20380271971225739), (1.4336779890807456, 0.19326113164424896), (1.4415048186467325, 0.18276318907737732), (1.4492101825828425, 0.17193584144115448), (1.4573516155996995, 0.16101877391338348), (1.4654361020081832, 0.14984729886054993), (1.4740077784704488, 0.13813693821430206), (1.4818444869019236, 0.12665075063705444), (1.4899535700718463, 0.11493690311908722), (1.497874155914078, 0.1031687930226326), (1.505656749775688, 0.0912393182516098), (1.5132644344025914, 0.07916105538606644), (1.5213353263443978, 0.06685461848974228), (1.529160379696873, 0.05449916422367096), (1.5369185278463064, 0.04191889613866806), (1.5446621000745353, 0.029172342270612717), (1.5530879572472733, 0.016709262505173683), (1.5603488295314385, 0.0033088726922869682), (1.5681243336336894, -0.010152872651815414), (1.5752503471504171, -0.020506225526332855), (1.5798161718169466, -0.015881085768342018), (1.5854693242705968, -0.010736859403550625), (1.5906049524388859, -0.006258642300963402), (1.595503179683495, -0.0019417250296100974), (1.6004994770052143, 0.002187121193856001), (1.6054930509877396, 0.006196163594722748), (1.610509098869536, 0.009801769629120827), (1.6156267339502097, 0.01337106991559267), (1.6209357234567268, 0.016497239470481873), (1.6263721533467863, 0.019567590206861496), (1.6316087284810668, 0.022868646308779716), (1.6364186520795392, 0.025793520733714104), (1.6416811259699775, 0.028736671432852745), (1.6467279944684876, 0.03121166303753853), (1.6522735671327, 0.033618342131376266), (1.6574505867689853, 0.035758890211582184), (1.6624949654117867, 0.03811368718743324), (1.66722396945763, 0.040203772485256195), (1.6723743104371596, 0.042150601744651794), (1.6773750072578548, 0.04361980780959129), (1.6825082793766843, 0.045262545347213745), (1.6876240475342137, 0.04642048850655556), (1.6924150510768645, 0.04751793295145035), (1.697433509097833, 0.04835496097803116), (1.7024466784468348, 0.04888416826725006), (1.7072404287251184, 0.049124348908662796), (1.7127199447384645, 0.04990961402654648), (1.7180831604864624, 0.050087831914424896), (1.7230775808518215, 0.050504475831985474), (1.7280794306371943, 0.05049602687358856), (1.7326907111713354, 0.05018913373351097), (1.737582030525558, 0.04954984039068222), (1.7425937314793363, 0.04891839250922203), (1.7477451399217363, 0.04828701540827751), (1.7531126882001793, 0.047258421778678894), (1.758250767745377, 0.0461028590798378), (1.763350629974023, 0.04537472873926163), (1.7684596995600002, 0.043595489114522934), (1.7732689099193153, 0.041861653327941895), (1.778273849417487, 0.03999390825629234), (1.783206265337093, 0.03799761086702347), (1.7886149812249132, 0.035967983305454254), (1.7928192107027228, 0.03356204181909561), (1.7988612093472336, 0.031019706279039383), (1.8037156231244489, 0.028391292318701744), (1.8089091463805307, 0.02526586502790451), (1.8140049220897183, 0.022490952163934708), (1.8191854836789942, 0.01955053210258484), (1.8244493062320661, 0.01622803322970867), (1.8295665762027356, 0.012678873725235462), (1.8344538853799615, 0.009056965820491314), (1.8393722972543227, 0.005208826623857021), (1.8441374269393298, 0.0013133608736097813), (1.8494839982360758, -0.0024556592106819153), (1.854334030996496, -0.007326860912144184), (1.8593034844373149, -0.011385476216673851), (1.864239794196012, -0.01616557314991951), (1.869208111419767, -0.01870046928524971), (1.8741524038371256, -0.01869972236454487), (1.8794001382477046, -0.018648652359843254), (1.8842891364722418, -0.018781442195177078), (1.8892997837616083, -0.01933646947145462), (1.8941329580410866, -0.018637459725141525), (1.8987668844600019, -0.016461996361613274), (1.9032808069595026, -0.014359625987708569), (1.9079708365545935, -0.012591179460287094), (1.9125486508026845, -0.010910719633102417), (1.917187902577844, -0.009360972791910172), (1.921741781953171, -0.00800754688680172), (1.9264099672845953, -0.0067775133065879345), (1.9309516775969167, -0.005830341950058937), (1.9355087451232014, -0.00505432952195406), (1.9400460571525042, -0.0044128308072686195), (1.9443978352897349, -0.0039419373497366905), (1.9488768546836972, -0.0037861980963498354), (1.953445155753891, -0.003633001586422324), (1.9575990666668028, -0.0038323041517287493), (1.9621827412757882, -0.004004652611911297), (1.9667233458294437, -0.004346108995378017), (1.9712080781124999, -0.004865237511694431), (1.9754818551235398, -0.005553494673222303), (1.9806000522015004, -0.0064745107665658), (1.9852495582086354, -0.0076229204423725605), (1.9896806496354669, -0.008708974346518517), (1.9938357001911318, -0.009932772256433964), (1.9987277541272515, -0.01157659012824297), (2.00322586866857, -0.013519841246306896), (2.0079511840894275, -0.015226082876324654), (2.0123765758148555, -0.016154654324054718), (2.016433985991153, -0.015919484198093414), (2.0205629731106254, -0.01563355326652527), (2.02462744498354, -0.01577955111861229), (2.028578813395452, -0.01628514938056469), (2.032740808118523, -0.01667587086558342), (2.0367968280010675, -0.01725975051522255), (2.0407803681206573, -0.017791273072361946), (2.044788156873924, -0.018449457362294197), (2.0489251233116477, -0.01849408447742462), (2.052490514273449, -0.01735576242208481), (2.056643622967513, -0.016465790569782257), (2.0602457300819084, -0.015843819826841354), (2.0602483814872525, -0.015843819826841354), (2.0674805432176604, -0.015535201877355576), (2.070729629979168, -0.015193811617791653), (2.0749796821050714, -0.015212117694318295), (2.078938248698762, -0.015404959209263325), (2.0827330545600766, -0.015675630420446396), (2.0863294301798723, -0.015287954360246658), (2.0901230936774575, -0.015170354396104813), (2.0938863449889835, -0.015265034511685371), (2.097613201111722, -0.015469702892005444), (2.1012466339718565, -0.015834838151931763), (2.1050263182907165, -0.016340240836143494), (2.108914903171174, -0.017144478857517242), (2.112518484735839, -0.01824074611067772), (2.11617397839225, -0.01922856643795967), (2.119965026574009, -0.020399704575538635), (2.123497137310462, -0.021717337891459465), (2.1270544225279338, -0.023255255073308945), (2.1307293920563373, -0.024568771943449974), (2.1334398832121213, -0.023129763081669807), (2.136243837973712, -0.021941691637039185), (2.139181099941028, -0.02084580436348915), (2.142079722363676, -0.020396320149302483), (2.144657210645093, -0.019786519929766655), (2.147759212838748, -0.01932239718735218), (2.1507492387533462, -0.018862275406718254), (2.153668724961931, -0.01870834454894066), (2.156611904162476, -0.018758591264486313), (2.159453797714974, -0.018930522724986076), (2.162370946217932, -0.019282301887869835), (2.165287965319924, -0.020005326718091965), (2.1680684639377428, -0.020236071199178696), (2.170766338797851, -0.02051282860338688), (2.173378513984899, -0.020838597789406776), (2.176158427569231, -0.021206384524703026), (2.1787933113588314, -0.022051755338907242), (2.181585991612758, -0.022773142904043198), (2.1841785550209587, -0.02376811020076275), (2.1868786431351768, -0.024263890460133553), (2.189216344932228, -0.024554135277867317), (2.1917829313703687, -0.02471567690372467), (2.1939839636449383, -0.02420681156218052), (2.196389256954984, -0.023839928209781647), (2.1985624648318014, -0.023618707433342934), (2.201011769170273, -0.023487308993935585), (2.202994808373591, -0.023221837356686592), (2.2051071416613266, -0.02318490482866764), (2.207381077389473, -0.023324502632021904), (2.2094267480934895, -0.023735305294394493), (2.211692144984235, -0.023904798552393913), (2.213608325819025, -0.023898780345916748), (2.2156016534421457, -0.023903515189886093), (2.2175928072827813, -0.023988928645849228), (2.2197521981084942, -0.02371545322239399), (2.221306557792643, -0.023802364245057106), (2.223070548826515, -0.023800769820809364), (2.2247532823439213, -0.02374628186225891), (2.226494523829695, -0.0237748846411705), (2.2282263625823804, -0.023869967088103294), (2.2299741180136383, -0.023906752467155457), (2.231730504501449, -0.02384127676486969), (2.2335688447899193, -0.023681173101067543), (2.2352588098181307, -0.023857619613409042), (2.2369971567000753, -0.024299174547195435), (2.2387534364348456, -0.024807866662740707), (2.240504662724944, -0.025534484535455704), (2.242172591819552, -0.02651853673160076), (2.2439720246619763, -0.027609115466475487), (2.2456345619286058, -0.02890099212527275), (2.247421114630241, -0.03021487593650818), (2.249269039434125, -0.031755976378917694), (2.250928488305429, -0.03363383561372757), (2.2529378059345797, -0.03521357849240303), (2.2546248731948197, -0.03739471361041069), (2.2564608211225035, -0.0385722815990448), (2.2574998015627488, -0.04297110065817833), (2.2588963074148642, -0.045764606446027756), (2.2605721806321775, -0.04846083000302315), (2.2621983253385665, -0.051414038985967636), (2.2641628488391325, -0.054379548877477646), (2.265605253857777, -0.05814196914434433), (2.267206375052138, -0.061733052134513855), (2.2689644276353875, -0.06538200378417969), (2.27067761551614, -0.06913304328918457), (2.27233698324495, -0.073152557015419), (2.273965427531368, -0.07728121429681778), (2.27580963767714, -0.08137204498052597), (2.2768194754370157, -0.0858122780919075), (2.279387035209612, -0.08990351855754852), (2.2811245376073432, -0.09438471496105194), (2.281095713437191, -0.09438471496105194), (2.281095713437191, -0.09438471496105194), (2.2810887740094468, -0.09438471496105194), (2.281083655089815, -0.09438471496105194), (2.2810971572183907, -0.09438471496105194), (2.281125357991865, -0.09438471496105194), (2.2811293878550627, -0.09438471496105194), (2.281172738118165, -0.09438471496105194), (2.281172738118165, -0.09438471496105194), (2.2812199100118034, -0.09438471496105194), (2.2812414505614873, -0.09438471496105194), (2.2812368712480935, -0.09438471496105194), (2.2812368712480935, -0.09438471496105194), (2.2812538232380284, -0.09438471496105194), (2.281230722550919, -0.09438471496105194), (2.281230722550919, -0.09438471496105194), (2.280982676332515, -0.09438471496105194), (2.2812639096874623, -0.09438471496105194), (2.2812269615460163, -0.09438471496105194), (2.281253663785398, -0.09438471496105194), (2.2812323909533014, -0.09438471496105194), (2.2812222465555765, -0.09438471496105194), (2.281167315811615, -0.09438471496105194), (2.281167315811615, -0.09438471496105194), (2.281162507871404, -0.09438471496105194), (2.281119420781966, -0.09438471496105194), (2.2811064836434807, -0.09438471496105194), (2.281134895036533, -0.09438471496105194), (2.2810933294210036, -0.09438471496105194), (2.2810991540806325, -0.09438471496105194), (2.281090275788916, -0.09438471496105194), (2.2811055587628286, -0.09438471496105194), (2.281116450059058, -0.09438471496105194), (2.2811188785558625, -0.09438471496105194), (2.281119693476798, -0.09438471496105194), (2.2811557939246265, -0.09438471496105194), (2.2811733343820912, -0.09438471496105194), (2.2812065758992888, -0.09438471496105194), (2.281221271976317, -0.09438471496105194), (2.2812434057515274, -0.09438471496105194), (2.281256401977374, -0.09438471496105194), (2.281269357957481, -0.09438471496105194), (2.281269357957481, -0.09438471496105194), (2.2812535885605048, -0.09438471496105194), (2.2812535885605048, -0.09438471496105194), (2.2812365933595005, -0.09438471496105194), (2.2812365933595005, -0.09438471496105194), (2.2812240544980886, -0.09438471496105194), (2.2812213547491287, -0.09438471496105194), (2.281183245568208, -0.09438471496105194), (2.281183245568208, -0.09438471496105194), (2.2811934095707835, -0.09438471496105194), (2.281157583115649, -0.09438471496105194), (2.2811588091098205, -0.09438471496105194), (2.2811390975850476, -0.09438471496105194), (2.2811519853570874, -0.09438471496105194), (2.2811222121245898, -0.09438471496105194), (2.281113517527731, -0.09438471496105194), (2.2811098560003185, -0.09438471496105194), (2.281130216486035, -0.09438471496105194), (2.2811103725098274, -0.09438471496105194), (2.281133446739881, -0.09438471496105194), (2.2811539135656416, -0.09438471496105194), (2.281175433035156, -0.09438471496105194), (2.281190001496527, -0.09438471496105194), (2.2811963270849462, -0.09438471496105194), (2.2812255108145223, -0.09438471496105194), (2.281251736433843, -0.09438471496105194), (2.281251736433843, -0.09438471496105194), (2.2812358755153714, -0.09438471496105194), (2.281250353052024, -0.09438471496105194), (2.2812288893102104, -0.09438471496105194), (2.2812288893102104, -0.09438471496105194), (2.281204146565962, -0.09438471496105194), (2.281204241058365, -0.09438471496105194), (2.281200672438344, -0.09438471496105194), (2.2811762911910836, -0.09438471496105194), (2.2811948709705727, -0.09438471496105194), (2.2811489822526214, -0.09438471496105194), (2.2811740274302714, -0.09438471496105194), (2.281151194545678, -0.09438471496105194), (2.281122232664228, -0.09438471496105194), (2.2811312102576857, -0.09438471496105194), (2.2811247851707037, -0.09438471496105194), (2.281120138655571, -0.09438471496105194), (2.2811288605335602, -0.09438471496105194), (2.2811258451712004, -0.09438471496105194), (2.2811396891744433, -0.09438471496105194), (2.2811386315692403, -0.09438471496105194), (2.28118378625844, -0.09438471496105194), (2.28117692962581, -0.09438471496105194), (2.281182949369336, -0.09438471496105194), (2.281231669766551, -0.09438471496105194), (2.2812172777694135, -0.09438471496105194), (2.2812483170292204, -0.09438471496105194), (2.2812483170292204, -0.09438471496105194), (2.281225638992605, -0.09438471496105194), (2.281225300359521, -0.09438471496105194), (2.28121950785156, -0.09438471496105194), (2.281222336211628, -0.09438471496105194), (2.281222336211628, -0.09438471496105194), (2.281208796056501, -0.09438471496105194), (2.281189523585067, -0.09438471496105194), (2.281192195477602, -0.09438471496105194), (2.2811773621219062, -0.09438471496105194), (2.2811665009541953, -0.09438471496105194), (2.281135028564787, -0.09438471496105194), (2.2811549986380664, -0.09438471496105194), (2.2811269076551683, -0.09438471496105194), (2.2811127030998897, -0.09438471496105194), (2.281145671589867, -0.09438471496105194), (2.281145671589867, -0.09438471496105194), (2.2811422340969982, -0.09438471496105194), (2.281152944428265, -0.09438471496105194), (2.281183192183236, -0.09438471496105194), (2.281154867191905, -0.09438471496105194), (2.281167444555799, -0.09438471496105194), (2.281182334517902, -0.09438471496105194), (2.2811751636982738, -0.09438471496105194), (2.281166713851286, -0.09438471496105194), (2.281179596617031, -0.09438471496105194), (2.2811892080023197, -0.09438471496105194), (2.281211686004019, -0.09438471496105194), (2.281219925694894, -0.09438471496105194), (2.281219925694894, -0.09438471496105194), (2.280983224076706, -0.09438471496105194), (2.281233713045614, -0.09438471496105194), (2.281221135949804, -0.09438471496105194), (2.281221135949804, -0.09438471496105194), (2.2812102763668296, -0.09438471496105194), (2.2811900654892896, -0.09438471496105194), (2.2811900654892896, -0.09438471496105194), (2.281146894581781, -0.09438471496105194), (2.281138770262492, -0.09438471496105194), (2.281130504447306, -0.09438471496105194), (2.281119952481315, -0.09438471496105194), (2.2811309123649326, -0.09438471496105194), (2.2811445677511237, -0.09438471496105194), (2.281125575100694, -0.09438471496105194), (2.281113867377733, -0.09438471496105194), (2.2811260488650538, -0.09438471496105194), (2.2811302735581758, -0.09438471496105194), (2.2811509629165356, -0.09438471496105194), (2.2811510823504197, -0.09438471496105194), (2.2811513810281814, -0.09438471496105194), (2.2811599557601565, -0.09438471496105194), (2.2811799266757156, -0.09438471496105194), (2.2812088220142455, -0.09438471496105194), (2.281211773005706, -0.09438471496105194), (2.2811890875772245, -0.09438471496105194), (2.281215531635011, -0.09438471496105194), (2.2811970094180682, -0.09438471496105194), (2.2811993174977174, -0.09438471496105194), (2.2811961998177, -0.09438471496105194), (2.2811692288292265, -0.09438471496105194), (2.281184421262605, -0.09438471496105194), (2.281172361893175, -0.09438471496105194), (2.281166997132953, -0.09438471496105194), (2.2811568552828794, -0.09438471496105194), (2.28115209576095, -0.09438471496105194), (2.2811703128528946, -0.09438471496105194), (2.2811703128528946, -0.09438471496105194), (2.281151342370764, -0.09438471496105194), (2.281128650783683, -0.09438471496105194), (2.281128650783683, -0.09438471496105194), (2.2811119550261436, -0.09438471496105194), (2.2811025936441442, -0.09438471496105194), (2.281152247896327, -0.09438471496105194), (2.281153439951847, -0.09438471496105194), (2.281150688125137, -0.09438471496105194), (2.2811679731042473, -0.09438471496105194), (2.2811672466005, -0.09438471496105194), (2.2811866825767515, -0.09438471496105194), (2.2809502600914793, -0.09438471496105194), (2.2811984525938356, -0.09438471496105194), (2.2812167696709724, -0.09438471496105194), (2.2812167696709724, -0.09438471496105194), (2.2812029158867246, -0.09438471496105194)]
    rospy.init_node('optitrack_reader', anonymous=True)
    optitrack = OptiTrack()
    while True:
        print(f"Target: {optitrack.calculate_target_position_relative()}")
        # print(f"Object: {optitrack.calculate_object_position_relative()}")
        # print(f"Object:\n")
        # for p in optitrack.object_trajectory[-20:-1]:
        #     print(p)
        print(f" ----- ")
        time.sleep(1.)
